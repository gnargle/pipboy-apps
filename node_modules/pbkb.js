function pbkb(){this.alphabets=[["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"," ","UPR","DEL","END"],["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","NUM","DEL","END"],["1","2","3","4","5","6","7","8","9","0",".",",","!","?","@","/","(",")","$","'","=","+","-","#","&","*"," ","LWR","DEL","END"]]this.selectedAlpha=0;this.selectedLetter=0;this.homeY=100;this.homeX=370;this.cursor=0;this.assembledString="";this.finished=false;this.intervalId=-1}pbkb.prototype.drawLetter=function(index,x,y){let offset=index;if(index<0){offset=this.alphabets[this.selectedAlpha].length+index}else if(index>this.alphabets[this.selectedAlpha].length-1){offset=index-this.alphabets[this.selectedAlpha].length}let str=this.alphabets[this.selectedAlpha][offset];if(str.length>1){bC.drawString(str,x-9,y)}else{bC.drawString(str,x,y)}};pbkb.prototype.drawSelectedLetter=function(){let str=this.alphabets[this.selectedAlpha][this.selectedLetter];if(str.length>1){bC.setColor(3);bC.fillRect(this.homeX-10,this.homeY-1,this.homeX+19,this.homeY+18);bC.setColor(0);bC.drawString(str,this.homeX-9,this.homeY)}else{bC.setColor(3);bC.fillRect(this.homeX-1,this.homeY-1,this.homeX+9,this.homeY+18);bC.setColor(0);bC.drawString(str,this.homeX,this.homeY)}};pbkb.prototype.drawTextEntry=function(){bC.clear();bC.setFontMonofonto18();this.drawSelectedLetter();bC.setColor(3);this.drawLetter(this.selectedLetter-1,this.homeX-25,this.homeY-25);this.drawLetter(this.selectedLetter-1,this.homeX-25,this.homeY-25);this.drawLetter(this.selectedLetter-2,this.homeX-50,this.homeY-50);this.drawLetter(this.selectedLetter+1,this.homeX-25,this.homeY+25);this.drawLetter(this.selectedLetter+2,this.homeX-50,this.homeY+50);this.drawLetter(this.selectedLetter+3,this.homeX-75,this.homeY+25);this.drawLetter(this.selectedLetter+4,this.homeX-100,this.homeY);bC.drawString("...",this.homeX-84,this.homeY-25);bC.drawRect(10,5,260,200);bC.drawString(bC.wrapString(this.assembledString,240).join("\n"),15,10),bH.flip();bF.flip();bC.flip()};pbkb.prototype.input=function(d){Pip.knob1Click(d);if(d==0){var ltr=this.alphabets[this.selectedAlpha][this.selectedLetter];if(ltr=="UPR"){this.selectedAlpha=1}else if(ltr=="NUM"){this.selectedAlpha=2}else if(ltr=="LWR"){this.selectedAlpha=0}else if(ltr=="DEL"){if(this.cursor=0){this.assembledString=this.assembledString.substring(0,this.assembledString.length-this.cursor-1)}else{var str1=this.assembledString.substring(0,this.assembledString.length-this.cursor-1);var str2=this.assembledString.substring(this.assembledString.length-this.cursor);this.assembledString=str1+str2}}else if(ltr=="END"){this.finished=true;clearInterval(this.intervalId);Pip.removeAllListeners("knob1")}else{this.assembledString+=ltr}}else{this.selectedLetter-=d;if(this.selectedLetter>this.alphabets[this.selectedAlpha].length-1){this.selectedLetter=0}else if(this.selectedLetter<0){this.selectedLetter=this.alphabets[this.selectedAlpha].length-1}}this.drawTextEntry()};pbkb.prototype.textEntryLoop=function(){this.drawTextEntry();this.intervalId=setInterval(()=>{if(!this.finished){bH.flip();bF.flip();bC.flip()}},16)};exports.initKeyboard=function(){let o=new pbkb();o._onKnob1=o.input.bind(o);Pip.removeAllListeners("knob1");Pip.on('knob1',o._onKnob1);return o};